<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tensorflow JS</title>
  </head>
  <body>
    <script src="js/tf.min.js"></script>
    <script src="js/jquery-3.6.0.slim.js"></script>
    <script src="js/mobilenet@1.0.0.js"> </script>
    
    <script src="script.js"></script>


    <img id="img" src="datatest/granadilla.jpg"></img>

    <div class="col-6">
			<h2 class="ml-3">Predictions</h2>
			<ol id="prediction-list"></ol>
      <p id="p">Waktu yang dibutuhkan adalah : </p>
		</div>

    <script>
      const img = document.getElementById('img');
      var paragraph = document.getElementById("p");
      

      async function run(){
        const model = await tf.loadLayersModel('model/model.json');
        let tensor = tf.browser.fromPixels(img, 3)
		    .resizeNearestNeighbor([100, 100]) // change the image size
		    .expandDims()
		    .toFloat()
		    .reverse(-1); // RGB -> BGR
        var startTime = performance.now()
	      let predictions = await model.predict(tensor).data();
        var endTime = performance.now()
        let top5 = Array.from(predictions)
		    .map(function (p, i) { // this is Array.map
			    return {
				    probability: p,
				    className: TARGET_CLASSES[i] // we are selecting the value from the obj
			    };
		    }).sort(function (a, b) {
			    return b.probability - a.probability;
		    }).slice(0, 5);

	      $("#prediction-list").empty();
	      top5.forEach(function (p) {
		      $("#prediction-list").append(`<li>${p.className}: ${p.probability.toFixed(3)*100}</li>`);
		    });
        var text = document.createTextNode(((endTime - startTime) / 1000).toFixed(3) + ' detik' );
        paragraph.appendChild(text);
      }
      run();
    </script>

    
  </body>
</html>
